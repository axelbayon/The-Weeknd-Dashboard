<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test Formatter Percent</title>
</head>
<body>
    <h1>Test formatPercent()</h1>
    <div id="results"></div>
    
    <script>
        function formatPercent(value) {
            // Cas "Non mis-à-jour" : valeur 'N.D.' explicite, null, ou undefined
            if (value === 'N.D.' || value === null || value === undefined) {
                return 'Non mis-à-jour';
            }
            
            // Vérifier si c'est un nombre valide
            if (isNaN(value)) {
                return 'Non mis-à-jour';
            }

            const num = Number(value);
            
            // Cas spécial : 0 exact (pas de signe)
            if (num === 0) {
                return '0,00\u202F%';
            }
            
            // Utiliser Intl.NumberFormat avec signDisplay pour afficher +/- automatiquement
            const formatter = new Intl.NumberFormat('fr-FR', {
                style: 'percent',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
                signDisplay: 'always' // Toujours afficher le signe pour les valeurs non-nulles
            });
            
            // Diviser par 100 car Intl.NumberFormat multiplie par 100 pour les pourcentages
            return formatter.format(num / 100);
        }
        
        // Tests
        const tests = [
            { input: 8.24, expected: '+8,24 %' },
            { input: -2.59, expected: '−2,59 %' },
            { input: 0, expected: '0,00 %' },
            { input: null, expected: 'Non mis-à-jour' },
            { input: 'N.D.', expected: 'Non mis-à-jour' },
            { input: undefined, expected: 'Non mis-à-jour' }
        ];
        
        const resultsDiv = document.getElementById('results');
        tests.forEach(test => {
            const result = formatPercent(test.input);
            const pass = result === test.expected || result.replace(/\u2212/g, '−') === test.expected;
            resultsDiv.innerHTML += `
                <div style="padding: 10px; margin: 5px; background: ${pass ? '#d4edda' : '#f8d7da'}; border-radius: 4px;">
                    <strong>Input:</strong> ${JSON.stringify(test.input)}<br>
                    <strong>Expected:</strong> ${test.expected}<br>
                    <strong>Got:</strong> ${result}<br>
                    <strong>Status:</strong> ${pass ? '✅ PASS' : '❌ FAIL'}
                </div>
            `;
        });
    </script>
</body>
</html>
